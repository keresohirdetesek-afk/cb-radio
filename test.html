<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CB R√°di√≥ - Teszt</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-box {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        .test-box.error {
            border-left-color: #f44336;
        }
        .test-box.warning {
            border-left-color: #ff9800;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #45a049;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.success { background: #4CAF50; }
        .status.fail { background: #f44336; }
        .status.pending { background: #ff9800; }
        pre {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        h1 { color: #4CAF50; }
        h2 { color: #81C784; }
    </style>
</head>
<body>
    <h1>üìª CB R√°di√≥ - Rendszer Teszt</h1>
    <p>Ez az oldal ellen≈ërzi, hogy minden megfelel≈ëen m≈±k√∂dik-e.</p>
    
    <div class="test-box" id="browserTest">
        <h2>üåê B√∂ng√©sz≈ë kompatibilit√°s</h2>
        <p>B√∂ng√©sz≈ë: <span id="browserName"></span></p>
        <p>WebRTC t√°mogat√°s: <span id="webrtcSupport" class="status pending">Ellen≈ërz√©s...</span></p>
        <p>getUserMedia t√°mogat√°s: <span id="getUserMediaSupport" class="status pending">Ellen≈ërz√©s...</span></p>
        <p>WebSocket t√°mogat√°s: <span id="websocketSupport" class="status pending">Ellen≈ërz√©s...</span></p>
    </div>
    
    <div class="test-box" id="micTest">
        <h2>üé§ Mikrofon teszt</h2>
        <button onclick="testMicrophone()">Mikrofon tesztel√©se</button>
        <p id="micStatus"></p>
    </div>
    
    <div class="test-box" id="serverTest">
        <h2>üñ•Ô∏è Szerver kapcsolat</h2>
        <p>Szerver c√≠m: <code>ws://localhost:3001</code></p>
        <button onclick="testServer()">Szerver ellen≈ërz√©se</button>
        <p id="serverStatus"></p>
    </div>
    
    <div class="test-box">
        <h2>‚úÖ K√∂vetkez≈ë l√©p√©sek</h2>
        <ol>
            <li>Gy≈ëz≈ëdj meg r√≥la, hogy minden teszt sikeres (z√∂ld)</li>
            <li>Ind√≠tsd el a szervert: <code>npm start</code> vagy <code>./start.sh</code></li>
            <li>Nyisd meg a <code>cb-radio-standalone.html</code> f√°jlt</li>
            <li>Nyisd meg ugyanazt a f√°jlt egy m√°sik b√∂ng√©sz≈ë ablakban/eszk√∂z√∂n</li>
            <li>V√°lassz ugyanazt a csatorn√°t mindk√©t helyen</li>
            <li>Pr√≥b√°ld ki a kommunik√°ci√≥t!</li>
        </ol>
    </div>
    
    <div class="test-box warning">
        <h2>‚ö†Ô∏è Fontos tudnival√≥k</h2>
        <ul>
            <li>√âles k√∂rnyezetben HTTPS sz√ºks√©ges!</li>
            <li>Mobil b√∂ng√©sz≈ëkben enged√©lyezd a mikrofon hozz√°f√©r√©st</li>
            <li>A hanger≈ë gomb funkci√≥ nem minden b√∂ng√©sz≈ëben/eszk√∂z√∂n m≈±k√∂dik</li>
            <li>T≈±zfal eset√©n nyisd meg a 3001-es portot</li>
        </ul>
    </div>

    <script>
        // B√∂ng√©sz≈ë inform√°ci√≥
        document.getElementById('browserName').textContent = navigator.userAgent;
        
        // WebRTC t√°mogat√°s ellen≈ërz√©se
        if (window.RTCPeerConnection) {
            document.getElementById('webrtcSupport').textContent = 'T√°mogatott ‚úì';
            document.getElementById('webrtcSupport').className = 'status success';
        } else {
            document.getElementById('webrtcSupport').textContent = 'Nem t√°mogatott ‚úó';
            document.getElementById('webrtcSupport').className = 'status fail';
        }
        
        // getUserMedia t√°mogat√°s
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            document.getElementById('getUserMediaSupport').textContent = 'T√°mogatott ‚úì';
            document.getElementById('getUserMediaSupport').className = 'status success';
        } else {
            document.getElementById('getUserMediaSupport').textContent = 'Nem t√°mogatott ‚úó';
            document.getElementById('getUserMediaSupport').className = 'status fail';
        }
        
        // WebSocket t√°mogat√°s
        if (window.WebSocket) {
            document.getElementById('websocketSupport').textContent = 'T√°mogatott ‚úì';
            document.getElementById('websocketSupport').className = 'status success';
        } else {
            document.getElementById('websocketSupport').textContent = 'Nem t√°mogatott ‚úó';
            document.getElementById('websocketSupport').className = 'status fail';
        }
        
        // Mikrofon teszt
        async function testMicrophone() {
            const statusEl = document.getElementById('micStatus');
            statusEl.innerHTML = '<span class="status pending">Tesztel√©s...</span>';
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                statusEl.innerHTML = '<span class="status success">Mikrofon m≈±k√∂dik! ‚úì</span>';
                
                // Vizualiz√°ci√≥
                const audioContext = new AudioContext();
                const analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaStreamSource(stream);
                source.connect(analyser);
                analyser.fftSize = 256;
                
                const dataArray = new Uint8Array(analyser.frequencyBinCount);
                let maxVolume = 0;
                
                const measure = setInterval(() => {
                    analyser.getByteFrequencyData(dataArray);
                    const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
                    maxVolume = Math.max(maxVolume, average);
                    statusEl.innerHTML = `<span class="status success">Mikrofon m≈±k√∂dik! ‚úì</span><br>Jelenlegi hanger≈ë: ${Math.round(average)} / Max: ${Math.round(maxVolume)}`;
                }, 100);
                
                setTimeout(() => {
                    clearInterval(measure);
                    stream.getTracks().forEach(track => track.stop());
                    audioContext.close();
                    statusEl.innerHTML = '<span class="status success">Mikrofon teszt befejezve! ‚úì</span>';
                }, 5000);
                
            } catch (error) {
                console.error('Mikrofon hiba:', error);
                statusEl.innerHTML = `<span class="status fail">Hiba: ${error.message} ‚úó</span><br>Enged√©lyezd a mikrofon hozz√°f√©r√©st!`;
            }
        }
        
        // Szerver teszt
        async function testServer() {
            const statusEl = document.getElementById('serverStatus');
            statusEl.innerHTML = '<span class="status pending">Kapcsol√≥d√°s...</span>';
            
            try {
                const ws = new WebSocket('ws://localhost:3001');
                
                ws.onopen = () => {
                    statusEl.innerHTML = '<span class="status success">Szerver el√©rhet≈ë! ‚úì</span>';
                    ws.close();
                };
                
                ws.onerror = (error) => {
                    console.error('WebSocket hiba:', error);
                    statusEl.innerHTML = '<span class="status fail">Szerver nem el√©rhet≈ë! ‚úó</span><br>Bizonyosodj meg r√≥la, hogy a szerver fut (npm start)';
                };
                
                // Timeout 5 m√°sodperc ut√°n
                setTimeout(() => {
                    if (ws.readyState !== WebSocket.OPEN) {
                        ws.close();
                        statusEl.innerHTML = '<span class="status fail">Id≈ët√∫ll√©p√©s! ‚úó</span><br>A szerver nem v√°laszol.';
                    }
                }, 5000);
                
            } catch (error) {
                console.error('Kapcsolat hiba:', error);
                statusEl.innerHTML = `<span class="status fail">Hiba: ${error.message} ‚úó</span>`;
            }
        }
    </script>
</body>
</html>
